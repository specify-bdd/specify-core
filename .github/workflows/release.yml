name: Release
on:
  workflow_dispatch:
    inputs:
      version:
        description: "The version to release"
        required: true
        default: patch
        type: choice
        options:
          - major
          - minor
          - patch
          # - premajor
          # - preminor
          # - prepatch
      title:
        description: "The name of the release"
        required: false
        type: string
permissions:
  id-token: write # Required for OIDC
  contents: write # Required to create releases
concurrency:
  group: ${{ github.workflow }}
jobs:
  tag:
    name: Stage 1 - Tag
    uses: ./.github/workflows/release-stage-1-tag.yml
    with:
      version: ${{ inputs.version }}
      title: ${{ inputs.title }}
    secrets: inherit
  merge:
    name: Stage 2 - Merge
    needs: tag
    uses: ./.github/workflows/release-stage-2-merge.yml
    with:
      git_tag: ${{ needs.tag.outputs.git_tag }}
    secrets: inherit
  announce:
    name: Stage 3 - Announce
    needs: [ tag, merge ]
    uses: ./.github/workflows/release-stage-3-announce.yml
    with:
      git_tag: ${{ needs.tag.outputs.git_tag }}
      title: ${{ inputs.title }}
    secrets: inherit
  publish:
    name: Stage 4 - Publish
    needs: [ tag, merge, announce ]
    uses: ./.github/workflows/release-stage-4-publish.yml
